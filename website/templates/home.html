{% extends "base.html" %}
{% block title %}Home{% endblock %}

{% block content %}
<h1>This is the home page</h1>

<form id="routeForm">
    <label for="origin">Origin:</label>
    <input type="text" id="origin" name="origin" required><br>

    <label for="destination">Destination:</label>
    <input type="text" id="destination" name="destination" required><br>

    <label for="departure_date">Departure Date:</label>
    <input type="date" id="departure_date" name="departure_date" required><br>

    <input type="checkbox" id="direct_flight" name="direct_flight" value="true">
    <label for="direct_flight">Direct Flight Only</label><br>

    <button type="submit">Search</button>
</form>

<div id="output"></div>


<div class=" mt-3 mb-3">



    <div id="output"></div>
    <script>
        document.getElementById('routeForm').addEventListener('submit', function (event) {
            event.preventDefault();

            var form = event.target;
            var origin = form.elements.origin.value;
            var destination = form.elements.destination.value;
            var departureDate = form.elements.departure_date.value;
            var directFlight = form.elements.direct_flight.checked;

            var searchData = {
                origin: origin,
                destination: destination,
                departure_date: departureDate,
                direct_flight: directFlight
            };

            // Send data to backend for processing
            fetch('/get_route', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(searchData)
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    // console.log(data.direct_flight_data[0])
                    var output = document.getElementById('output');
                    output.innerHTML = ''; // 



                    if (data.hasOwnProperty('direct_flight_data')) {
                        console.log("Ttue")
                        if (data.direct_flight_data.length > 0) {

                            for (i = 0; i < data.direct_flight_data.length; i++) {
                                var route = data.direct_flight_data[i]
                              

                                var codeBlock = `<div class="card w-50 mb-2">
                                    <div class="card-body">
                                    <h5 class="card-title">Source Airport: ${route[0][0][0]}</h5>
                                    <h5 class="card-title">Destination Airport: ${route[0][1]}</h5>
                                    <p class="card-text">Distance: ${route[1]} km</p>
                                    <p class="card-text">Airline: ${route[2]} </p>
                                    <p class="card-text">Price: $${route[3]} </p>

                                    <a href="#" class="btn btn-primary">View More</a>
                                    </div>
                                    </div>`;


                                output.innerHTML += codeBlock





                            }




                        }


                    }
                    else {
                        console.log("False")
                        if (data.indirect_flight_data.length > 0) {

                            for (i = 0; i < data.indirect_flight_data.length; i++) {
                                var route = data.indirect_flight_data[i]
                                console.log("---------------------------------------")
                                console.log(route)
                                console.log("---------------------------------------")
                                var routeInfo=""
                                for (let j = 0; j < route[0].length ; j++) {
                                    console.log(route[0])
                                    console.log(route[0][j])
                                    
                                    routeInfo += route[0][j];
                                    if (j < route[0][j].length -1) {
                                        routeInfo += ' -> '

                                    }

                                }

                                var codeBlock = `<div class="card w-50 mb-2">
                                <div class="card-body">
                                <h5 class="card-title">Source Airport: ${route[0][0]}</h5>
                                <h5 class="card-title">Destination Airport: ${route[0][1]}</h5>
                                <p class="card-text">Distance: ${route[1]} km</p>
                                <p class="card-text">Airline: ${route[2]} </p>
                                <p class="card-text">Price: $${route[3]} </p>
                                <p class="card-text">Route: ${routeInfo}</p>

                                <a href="#" class="btn btn-primary">View More</a>
                                </div>
                                </div>`;


                                output.innerHTML += codeBlock





                            }




                        }




                    }







                }
                )
                .catch(error => {
                    console.error('Error:', error);
                    // Handle error
                });
        });
    </script>


    {% endblock %}